---
title: TanStack Form
description: Generate formOptions for TanStack Form with Zod validation.
---

# TanStack Form

Tangrams generates `formOptions` with Zod validators from your mutations. These snap right into TanStack Form's `useForm` hook.

## Peer Dependencies

import { Tab, Tabs } from 'fumadocs-ui/components/tabs';

<Tabs items={['bun', 'npm', 'pnpm']}>
  <Tab value="bun">
```bash
bun add @tanstack/react-form zod
```
  </Tab>
  <Tab value="npm">
```bash
npm install @tanstack/react-form zod
```
  </Tab>
  <Tab value="pnpm">
```bash
pnpm add @tanstack/react-form zod
```
  </Tab>
</Tabs>

## Setup

### GraphQL Source

Configure a GraphQL source with `"form"` in the generates array:

```typescript
import { defineConfig } from "tangrams"

export default defineConfig({
  sources: [
    {
      name: "graphql",
      type: "graphql",
      schema: {
        url: "http://localhost:4000/graphql",
      },
      documents: "./src/graphql/**/*.graphql",
      generates: ["form"],
    },
  ],
})
```

Forms are generated from **mutation** operations. Create mutations in your `.graphql` files:

```graphql
# src/graphql/user.graphql

mutation CreateUser($input: CreateUserInput!) {
  createUser(input: $input) {
    id
    name
  }
}

mutation UpdateUser($id: ID!, $input: UpdateUserInput!) {
  updateUser(id: $id, input: $input) {
    id
    name
  }
}
```

### OpenAPI Source

Configure an OpenAPI source with `"form"` in the generates array:

```typescript
import { defineConfig } from "tangrams"

export default defineConfig({
  sources: [
    {
      name: "api",
      type: "openapi",
      spec: "./openapi.yaml",
      generates: ["form"],
    },
  ],
})
```

Forms are generated from **POST**, **PUT**, and **PATCH** operations that have request bodies.

### Generate

Run the generator:

```bash
bunx tangrams generate
```

## Generated Output

### Output Directory Structure

```
src/generated/
└── <source>/
    ├── schema.ts         # Zod schemas for request bodies
    └── form/
        └── forms.ts      # formOptions exports
```

### What Gets Generated

For each mutation with a request body, Tangrams generates a `formOptions` export with:

- **`defaultValues`** - Empty object with type assertion for type safety
- **`validators`** - The Zod schema for validation (configurable timing)

**Example `forms.ts`:**

```typescript
import { formOptions } from "@tanstack/react-form"

import { createUserRequestSchema, updateUserRequestSchema } from "../schema"
import type { CreateUserRequest, UpdateUserRequest } from "../schema"

export const createUserFormOptions = formOptions({
  defaultValues: {} as CreateUserRequest,
  validators: {
    onSubmitAsync: createUserRequestSchema,
  },
})

export const updateUserFormOptions = formOptions({
  defaultValues: {} as UpdateUserRequest,
  validators: {
    onSubmitAsync: updateUserRequestSchema,
  },
})
```

## Usage

### Basic Form

Spread the generated `formOptions` into `useForm`:

```typescript
import { useForm } from "@tanstack/react-form"
import { createUserFormOptions } from "./generated/form/api/forms"

function CreateUserForm() {
  const form = useForm({
    ...createUserFormOptions,
    onSubmit: async ({ value }) => {
      // value is fully typed
      console.log("Submitting:", value)
    },
  })

  return (
    <form
      onSubmit={(e) => {
        e.preventDefault()
        form.handleSubmit()
      }}
    >
      <form.Field
        name="name"
        children={(field) => (
          <div>
            <label>Name</label>
            <input
              value={field.state.value}
              onChange={(e) => field.handleChange(e.target.value)}
            />
            {field.state.meta.errors.length > 0 && (
              <span>{field.state.meta.errors.join(", ")}</span>
            )}
          </div>
        )}
      />
      <form.Field
        name="email"
        children={(field) => (
          <div>
            <label>Email</label>
            <input
              type="email"
              value={field.state.value}
              onChange={(e) => field.handleChange(e.target.value)}
            />
            {field.state.meta.errors.length > 0 && (
              <span>{field.state.meta.errors.join(", ")}</span>
            )}
          </div>
        )}
      />
      <button type="submit">Create User</button>
    </form>
  )
}
```

### Combining with Mutations

Use the generated `formOptions` alongside `mutationOptions` from [TanStack Query](/docs/tanstack-query) for a complete form submission flow:

```typescript
import { useForm } from "@tanstack/react-form"
import { useMutation } from "@tanstack/react-query"

import { createUserFormOptions } from "./generated/api/form/forms"
import { createUserMutationOptions, getUsersQueryOptions } from "./generated/api/query/operations"

function CreateUserForm() {
  const mutation = useMutation({
    ...createUserMutationOptions(),
    onSuccess: (_d, _v, _r, { client }) => client.invalidateQueries(getUsersQueryOptions())
  })

  const form = useForm({
    ...createUserFormOptions,
    onSubmit: async ({ value }) => {
      await mutation.mutateAsync(value)
    },
  })

  return (
    <form
      onSubmit={(e) => {
        e.preventDefault()
        form.handleSubmit()
      }}
    >
      {/* ... form fields */}
      <button type="submit" disabled={mutation.isPending}>
        {mutation.isPending ? "Creating..." : "Create User"}
      </button>
      {mutation.isError && (
        <div>Error: {mutation.error.message}</div>
      )}
    </form>
  )
}
```

### Setting Default Values

The generated `formOptions` use an empty object with a type assertion for `defaultValues`. You should provide your own default values when using the form:

```typescript
import { useForm } from "@tanstack/react-form"
import { createUserFormOptions } from "./generated/api/form/forms"
import type { CreateUserRequest } from "./generated/api/schema"

function CreateUserForm() {
  const defaultValues: CreateUserRequest = {
    name: "",
    email: "",
    role: "user"
  }

  const form = useForm({
    ...createUserFormOptions,
    defaultValues,
    onSubmit: async ({ value }) => {
      // ...
    },
  })

  // ...
}
```

### Edit Forms with Existing Data

For edit forms, populate `defaultValues` with the existing data:

```typescript
import { useForm } from "@tanstack/react-form"
import { updateUserFormOptions } from "./generated/api/form/forms"
import type { UpdateUserRequest } from "./generated/api/schema"

function EditUserForm({ user }: { user: User }) {
  const defaultValues: UpdateUserRequest = {
    name: user.name,
    email: user.email,
    bio: user.bio ?? ""
  }

  const form = useForm({
    ...updateUserFormOptions,
    defaultValues,
    onSubmit: async ({ value }) => {
      // ...
    },
  })

  return (
    // ... form JSX
  )
}
```

## Validator Configuration

By default, Tangrams generates form options with `onSubmitAsync` validation. You can customize the validator timing using the `overrides.form` configuration:

### Available Validators

```typescript
// tangrams.config.ts
import { defineConfig } from "tangrams"

export default defineConfig({
  sources: [
    {
      name: "api",
      type: "openapi",
      spec: "./openapi.yaml",
      generates: ["form"],
      overrides: {
        form: {
          // Choose one of:
          // "onChange"       - Validate on every change (sync)
          // "onChangeAsync"  - Validate on every change (async)
          // "onBlur"         - Validate when field loses focus (sync)
          // "onBlurAsync"    - Validate when field loses focus (async)
          // "onSubmit"       - Validate on submit (sync)
          // "onSubmitAsync"  - Validate on submit (async) - DEFAULT
          // "onDynamic"      - Dynamic validation with revalidation logic
          validator: "onBlurAsync",
        },
      },
    },
  ],
})
```

### Dynamic Validation

The `onDynamic` validator uses TanStack Form's `revalidateLogic` for smart revalidation. Configure when validation runs initially and after the first submission:

```typescript
overrides: {
  form: {
    validator: "onDynamic",
    validationLogic: {
      mode: "submit",                // Initial validation: "change" | "blur" | "submit"
      modeAfterSubmission: "change", // After first submit: "change" | "blur" | "submit"
    },
  },
}
```

**Generated output with `onDynamic`:**

```typescript
import { formOptions, revalidateLogic } from "@tanstack/react-form"

import { createUserRequestSchema } from "../schema"
import type { CreateUserRequest } from "../schema"

export const createUserFormOptions = formOptions({
  defaultValues: {} as CreateUserRequest,
  validationLogic: revalidateLogic({ mode: "submit", modeAfterSubmission: "change" }),
  validators: {
    onDynamic: createUserRequestSchema,
  },
})
```

This pattern validates on submit initially, then revalidates on every change after the first submission attempt - a common UX pattern for forms.

## Configuration Reference

### GraphQL Source Options

| Option | Type | Required | Description |
|--------|------|----------|-------------|
| `name` | `string` | Yes | Unique name for this source (lowercase alphanumeric with hyphens, starting with a letter) |
| `type` | `"graphql"` | Yes | Source type |
| `schema` | `object` | Yes | Schema configuration (URL or file-based) |
| `documents` | `string \| string[]` | Yes | Glob pattern(s) for `.graphql` files |
| `generates` | `array` | Yes | Must include `"form"` |
| `overrides` | `object` | No | Override scalars, DB, and form settings (see [Configuration Reference](/docs#overrides-configuration)) |

### OpenAPI Source Options

| Option | Type | Required | Description |
|--------|------|----------|-------------|
| `name` | `string` | Yes | Unique name for this source (lowercase alphanumeric with hyphens, starting with a letter) |
| `type` | `"openapi"` | Yes | Source type |
| `spec` | `string` | Yes | Path to OpenAPI spec (local or URL) |
| `headers` | `Record<string, string>` | No | Headers for fetching remote spec |
| `include` | `string[]` | No | Glob patterns for paths to include |
| `exclude` | `string[]` | No | Glob patterns for paths to exclude |
| `generates` | `array` | Yes | Must include `"form"` |
| `overrides` | `object` | No | Override DB and form settings (see [Configuration Reference](/docs#overrides-configuration)) |

### Form Overrides

Configure form generation behavior using `overrides.form`:

| Option | Type | Default | Description |
|--------|------|---------|-------------|
| `validator` | `string` | `"onSubmitAsync"` | Validator timing (see [available validators](#available-validators)) |
| `validationLogic` | `object` | - | Configuration for `onDynamic` validator only |
| `validationLogic.mode` | `string` | `"submit"` | Initial validation trigger: `"change"`, `"blur"`, or `"submit"` |
| `validationLogic.modeAfterSubmission` | `string` | `"change"` | Revalidation trigger after first submit |
