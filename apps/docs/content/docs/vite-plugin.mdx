---
title: Vite Plugin
description: Configure tangrams directly in your vite.config.ts
---

# Vite Plugin

For Vite projects, tangrams provides a plugin that integrates code generation directly into your build process. This allows you to configure tangrams in your `vite.config.ts` instead of a separate config file.

## Installation

```bash
bun add -D tangrams vite
```

## Basic Usage

```ts title="vite.config.ts"
import { defineConfig } from "vite"
import { tangrams } from "tangrams/vite"

export default defineConfig({
  plugins: [
    tangrams({
      sources: [
        {
          name: "api",
          type: "graphql",
          schema: { url: "http://localhost:4000/graphql" },
          documents: "./src/graphql/operations.graphql",
          generates: ["query"],
        },
      ],
    }),
  ],
})
```

The plugin will:
- Run code generation on both dev server start and production builds
- Watch for file changes in development and automatically regenerate
- Clean up stale directories by default

## Plugin Options

### Configuration Options

These options mirror the tangrams config file options:

| Option | Type | Default | Description |
|--------|------|---------|-------------|
| `sources` | `SourceConfig[]` | - | Data sources to generate from |
| `output` | `string` | `"."` | Output directory for generated files |
| `validator` | `"zod" \| "valibot" \| "arktype" \| "effect"` | `"zod"` | Validation library |

### Plugin-Specific Options

These options control plugin behavior:

| Option | Type | Default | Description |
|--------|------|---------|-------------|
| `force` | `boolean` | `false` | Force regenerate all files including client.ts |
| `watch` | `boolean` | `true` | Watch for file changes in dev mode |
| `clean` | `boolean` | `true` | Automatically remove stale source directories |
| `configFile` | `string` | - | Path to external config file |

## Using External Config

Instead of inlining your configuration, the plugin can load from an external config file. This is useful when:

- Migrating from CLI-based generation
- Sharing config between CLI and plugin
- Keeping your vite.config.ts clean

### Auto-Discovery

Call the plugin with no arguments to auto-discover `tangrams.config.ts`:

```ts title="vite.config.ts"
import { defineConfig } from "vite"
import { tangrams } from "tangrams/vite"

export default defineConfig({
  plugins: [
    tangrams(), // Loads tangrams.config.ts automatically
  ],
})
```

### Custom Config Path

Specify a custom config file path:

```ts title="vite.config.ts"
import { defineConfig } from "vite"
import { tangrams } from "tangrams/vite"

export default defineConfig({
  plugins: [
    tangrams({
      configFile: "./config/tangrams.config.ts",
    }),
  ],
})
```

## Watch Mode

In development, the plugin watches for changes to:

- **GraphQL documents** - Files matching your `documents` patterns
- **OpenAPI specs** - Local spec files (not remote URLs)

When changes are detected:
1. The plugin regenerates affected artifacts
2. A full page reload is triggered to pick up the changes

### Disabling Watch

If you prefer to regenerate manually, disable watch mode:

```ts
tangrams({
  watch: false,
  // ...
})
```

## Cleanup Behavior

By default, the plugin automatically removes stale source directories when sources are renamed or removed from your configuration. This keeps your generated output clean.

### How Cleanup Works

1. Tangrams tracks generated sources in a manifest file
2. On each generation, it compares the manifest to your current config
3. Directories that no longer have a matching source are removed
4. If a source was renamed (same schema, different name), client.ts is preserved

### Disabling Cleanup

If you prefer to manage cleanup manually:

```ts
tangrams({
  clean: false,
  // ...
})
```

## Examples

### GraphQL with TanStack Query

```ts title="vite.config.ts"
import { defineConfig } from "vite"
import { tangrams } from "tangrams/vite"

export default defineConfig({
  plugins: [
    tangrams({
      sources: [
        {
          name: "api",
          type: "graphql",
          schema: { url: "http://localhost:4000/graphql" },
          documents: "./src/graphql/operations.graphql",
          generates: ["query"],
        },
      ],
    }),
  ],
})
```

### OpenAPI with Forms

```ts title="vite.config.ts"
import { defineConfig } from "vite"
import { tangrams } from "tangrams/vite"

export default defineConfig({
  plugins: [
    tangrams({
      validator: "valibot",
      sources: [
        {
          name: "petstore",
          type: "openapi",
          spec: "./openapi.yaml",
          generates: ["query", "form"],
        },
      ],
    }),
  ],
})
```

### Multiple Sources

```ts title="vite.config.ts"
import { defineConfig } from "vite"
import { tangrams } from "tangrams/vite"

export default defineConfig({
  plugins: [
    tangrams({
      sources: [
        {
          name: "users",
          type: "graphql",
          schema: { url: "http://localhost:4000/users/graphql" },
          documents: "./src/graphql/users/operations.graphql",
          generates: ["query", "form"],
        },
        {
          name: "products",
          type: "openapi",
          spec: "https://api.example.com/openapi.json",
          generates: ["query"],
        },
      ],
    }),
  ],
})
```

## Migration from CLI

If you're currently using the CLI and want to switch to the plugin:

1. Install the plugin (tangrams already includes it)
2. Add the plugin to your vite.config.ts
3. Either:
   - Copy your config inline, or
   - Use `tangrams()` to auto-load your existing config file
4. Remove CLI-based generation from your build scripts

The generated output is identical whether using CLI or plugin.
